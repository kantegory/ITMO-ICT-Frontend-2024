<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Услуги стоматологической клиники</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/services.css">
    <link rel="stylesheet" href="css/themes.css">
</head>

<body>
<header id="header"></header>

<main class="container mt-4" role="main">
    <h1 class="text-center mb-4">Стоматологические услуги</h1>

    <div class="row mb-4">
        <div class="col-12 text-center">
            <label for="serviceFilter" class="form-label visually-hidden">Фильтр услуг</label>
            <select id="serviceFilter" class="form-select w-50 mx-auto" aria-label="Фильтр услуг">
                <option value="all">Все услуги</option>
            </select>
        </div>
    </div>

    <div class="row" id="services-list" role="list">
        <div class="col-12 text-center">
            <p>Загрузка услуг...</p>
        </div>
    </div>
</main>

<footer id="footer"></footer>

<script src="js/bootstrap.bundle.min.js"></script>
<script src="js/include.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const servicesList = document.getElementById('services-list');
        const serviceFilter = document.getElementById('serviceFilter');
        let allServices = [];

        const fetchServices = async () => {
            try {
                const response = await fetch('http://localhost:8080/api/v1/services');
                if (!response.ok) {
                    throw new Error('Не удалось загрузить услуги. Статус: ' + response.status);
                }
                const data = await response.json();
                allServices = data;
                populateFilterOptions(allServices);
                displayServices(allServices);
            } catch (error) {
                servicesList.innerHTML = `<div class="col-12 text-center"><p>Ошибка загрузки услуг: ${error.message}</p></div>`;
                console.error('Ошибка при выполнении запроса:', error);
            }
        };

        const populateFilterOptions = (services) => {
            const selectedValue = serviceFilter.value;
            serviceFilter.innerHTML = '<option value="all">Все услуги</option>';

            const uniqueServices = [...new Set(services.map(service => service.name))].sort();

            uniqueServices.forEach(serviceName => {
                const option = document.createElement('option');
                option.value = serviceName;
                option.textContent = serviceName;
                serviceFilter.appendChild(option);
            });

            if (uniqueServices.includes(selectedValue)) {
                serviceFilter.value = selectedValue;
            } else {
                serviceFilter.value = 'all';
            }
        };

        const displayServices = (services) => {
            servicesList.innerHTML = '';

            if (services.length === 0) {
                servicesList.innerHTML = `<div class="col-12 text-center"><p>Нет услуг по выбранному фильтру.</p></div>`;
                return;
            }

            services.forEach(service => {
                const serviceCard = document.createElement('div');
                serviceCard.classList.add('col-md-4', 'mb-4', 'service-card');

                serviceCard.innerHTML = `
                        <div class="card h-100">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">${service.name}</h5>
                                <p class="card-text">${service.description}</p>
                                <a href="#" class="btn btn-primary mt-auto">Подробнее</a>
                            </div>
                        </div>
                    `;

                servicesList.appendChild(serviceCard);
            });
        };

        serviceFilter.addEventListener('change', () => {
            const selectedService = serviceFilter.value;
            if (selectedService === 'all') {
                displayServices(allServices);
            } else {
                const filteredServices = allServices.filter(service => service.name === selectedService);
                displayServices(filteredServices);
            }
        });

        fetchServices();
    });
</script>

</body>
</html>